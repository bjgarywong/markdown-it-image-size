var e;function t(t){return t>=e.NUMBER_ZERO&&t<=e.NUMBER_NINE}function r(r,n,i){const o=function(r,n,i){for(let o=r;o<n;o+=1){const r=i.charCodeAt(o);if(!t(r)&&r!==e.PERCENTAGE)return o}return n}(n,i,r);return{position:o,value:r.slice(n,o)}}!function(e){e[e.EXCLAMATION_MARK=33]="EXCLAMATION_MARK",e[e.OPENING_BRACKET=91]="OPENING_BRACKET",e[e.OPENING_PARENTHESIS=40]="OPENING_PARENTHESIS",e[e.WHITESPACE=32]="WHITESPACE",e[e.NEW_LINE=10]="NEW_LINE",e[e.EQUALS=61]="EQUALS",e[e.LOWER_CASE_X=120]="LOWER_CASE_X",e[e.NUMBER_ZERO=48]="NUMBER_ZERO",e[e.NUMBER_NINE=57]="NUMBER_NINE",e[e.PERCENTAGE=37]="PERCENTAGE"}(e||(e={}));const n=(t,r)=>{let n=t;for(;n<r.posMax;){const t=r.src.charCodeAt(n);if(t!==e.WHITESPACE&&t!==e.NEW_LINE)break;n+=1}return n},i=(t,i)=>{let o,s,E,c="",a="",N="";const A=t.pos,p=t.posMax;if(!(t=>t.src.charCodeAt(t.pos)===e.EXCLAMATION_MARK&&t.src.charCodeAt(t.pos+1)===e.OPENING_BRACKET)(t))return!1;const h=t.pos+2,u=t.md.helpers.parseLinkLabel(t,t.pos+1,!1);if(u<0)return!1;if(o=u+1,o<p&&t.src.charCodeAt(o)===e.OPENING_PARENTHESIS){if(o+=1,o=n(o,t),o>=p)return!1;const i=function(e,t){const r=e.md.helpers.parseLinkDestination(e.src,t,e.posMax);if(!r.ok)return;const n=e.md.normalizeLink(r.str);return e.md.validateLink(n)?{position:r.pos,href:n}:{position:t,href:""}}(t,o);if(!i)return!1;o=i.position,c=i.href,E=o,o=n(o,t);const h=t.md.helpers.parseLinkTitle(t.src,o,t.posMax);o<p&&E!==o&&h.ok?(s=h.str,o=h.pos,o=n(o,t)):s="";const u=function(t,i){if(t-1<0)return;if(i.src.charCodeAt(t-1)!==e.WHITESPACE)return;const o=function(t,n,i){if(n>=i)return;let o=n;if(t.charCodeAt(o)!==e.EQUALS)return;if(o+=1,!((s=t.charCodeAt(o))===e.LOWER_CASE_X||s>=e.NUMBER_ZERO&&s<=e.NUMBER_NINE))return;var s;const E=r(t,o,i);if(o=E.position,t.charCodeAt(o)!==e.LOWER_CASE_X)return;o+=1;const c=r(t,o,i);return o=c.position,{width:E.value,height:c.value,position:o}}(i.src,t,i.posMax);return o?{position:n(o.position,i),width:o.width,height:o.height}:void 0}(o,t);if(u&&(o=u.position,a=u.width,N=u.height),o>=p||41!==t.src.charCodeAt(o))return t.pos=A,!1;o+=1}else{if(void 0===t.env.references)return!1;let e;o=n(o,t),o<p&&91===t.src.charCodeAt(o)?(E=o+1,o=t.md.helpers.parseLinkLabel(t,o),o>=0?e=t.src.slice(E,o+=1):o=u+1):o=u+1,e||(e=t.src.slice(h,u));const r=t.env.references[t.md.utils.normalizeReference(e)];if(!r)return t.pos=A,!1;c=r.href,s=r.title}return i||(""==a&&""==N&&(a="100%"),function(e,t,r,n,i,o,s){e.pos=t,e.posMax=r;const E=e.push("image","img",0);E.children=[];const c=new e.md.inline.State(e.src.slice(t,r),e.md,e.env,E.children);c.md.inline.tokenize(c),E.attrSet("src",n),E.attrSet("alt",""),i&&E.attrSet("title",i),""!==o&&E.attrSet("width",o),""!==s&&E.attrSet("height",s)}(t,h,u,c,s,a,N)),t.pos=o,t.posMax=p,!0},o=e=>{e.inline.ruler.before("emphasis","image",i)};export{o as imageSize};
//# sourceMappingURL=index.mjs.map
