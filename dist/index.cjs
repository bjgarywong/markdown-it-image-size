var e;function r(r){return r>=e.NUMBER_ZERO&&r<=e.NUMBER_NINE}function t(t,i,n){var o=function(t,i,n){for(var o=t;o<i;o+=1){var a=n.charCodeAt(o);if(!r(a)&&a!==e.PERCENTAGE)return o}return i}(i,n,t);return{position:o,value:t.slice(i,o)}}!function(e){e[e.EXCLAMATION_MARK=33]="EXCLAMATION_MARK",e[e.OPENING_BRACKET=91]="OPENING_BRACKET",e[e.OPENING_PARENTHESIS=40]="OPENING_PARENTHESIS",e[e.WHITESPACE=32]="WHITESPACE",e[e.NEW_LINE=10]="NEW_LINE",e[e.EQUALS=61]="EQUALS",e[e.LOWER_CASE_X=120]="LOWER_CASE_X",e[e.NUMBER_ZERO=48]="NUMBER_ZERO",e[e.NUMBER_NINE=57]="NUMBER_NINE",e[e.PERCENTAGE=37]="PERCENTAGE"}(e||(e={}));var i=function(e,r,t,i,n){var o=e[r],a=o.attrs;a[o.attrIndex("alt")][1]=n.renderInlineAsText(o.children,t,i);var s=n.renderToken(e,r,t);return a.find(function(e){return"width"==e[0]||"height"==e[0]})||(s.endsWith("/>")?s=s.slice(0,-2)+' style="max-width:100%"/>':s.endsWith(">")&&(s=s.slice(0,-1)+' style="max-width:100%">')),s},n=function(r,t){for(var i=r;i<t.posMax;){var n=t.src.charCodeAt(i);if(n!==e.WHITESPACE&&n!==e.NEW_LINE)break;i+=1}return i},o=function r(i,o){var a,s,E,c="",d="",h="",u=i.pos,f=i.posMax;if(!function(r){return r.src.charCodeAt(r.pos)===e.EXCLAMATION_MARK&&r.src.charCodeAt(r.pos+1)===e.OPENING_BRACKET}(i))return!1;var N=i.pos+2,A=i.md.helpers.parseLinkLabel(i,i.pos+1,!1);if(A<0)return!1;if((a=A+1)<f&&i.src.charCodeAt(a)===e.OPENING_PARENTHESIS){if((a=n(a+=1,i))>=f)return!1;var l=function(e,r){var t=e.md.helpers.parseLinkDestination(e.src,r,e.posMax);if(t.ok){var i=e.md.normalizeLink(t.str);return e.md.validateLink(i)?{position:t.pos,href:i}:{position:r,href:""}}}(i,a);if(!l)return!1;c=l.href,E=a=l.position,a=n(a,i);var p=i.md.helpers.parseLinkTitle(i.src,a,i.posMax);a<f&&E!==a&&p.ok?(s=p.str,a=n(a=p.pos,i)):s="";var v=function(r,i){if(!(r-1<0)&&i.src.charCodeAt(r-1)===e.WHITESPACE){var o=function(r,i,n){if(!(i>=n)){var o=i;if(r.charCodeAt(o)===e.EQUALS&&((E=r.charCodeAt(o+=1))===e.LOWER_CASE_X||E>=e.NUMBER_ZERO&&E<=e.NUMBER_NINE)){var a=t(r,o,n);if(r.charCodeAt(o=a.position)===e.LOWER_CASE_X){var s=t(r,o+=1,n);return{width:a.value,height:s.value,position:o=s.position}}}}var E}(i.src,r,i.posMax);if(o)return{position:n(o.position,i),width:o.width,height:o.height}}}(a,i);if(v&&(a=v.position,d=v.width,h=v.height),a>=f||41!==i.src.charCodeAt(a))return i.pos=u,!1;a+=1}else{if(void 0===i.env.references)return!1;var R;(a=n(a,i))<f&&91===i.src.charCodeAt(a)?(E=a+1,(a=i.md.helpers.parseLinkLabel(i,a))>=0?R=i.src.slice(E,a+=1):a=A+1):a=A+1,R||(R=i.src.slice(N,A));var C=i.env.references[i.md.utils.normalizeReference(R)];if(!C)return i.pos=u,!1;c=C.href,s=C.title}if(!o){if(""==d&&""==h&&!r.customRender){var _=r.defaultWidth;void 0!==_&&(d=_)}!function(e,r,t,i,n,o,a){e.pos=r,e.posMax=t;var s=e.push("image","img",0);s.children=[];var E=new e.md.inline.State(e.src.slice(r,t),e.md,e.env,s.children);E.md.inline.tokenize(E),s.attrSet("src",i),s.attrSet("alt",""),n&&s.attrSet("title",n),""!==o&&s.attrSet("width",o),""!==a&&s.attrSet("height",a)}(i,N,A,c,s,d,h)}return i.pos=a,i.posMax=f,!0};exports.imageSize=function(e,r){void 0!==r&&(r.defaultWidth&&(o.defaultWidth=r.defaultWidth),r.customRender&&(o.customRender=r.customRender,e.renderer.rules.image=i)),e.inline.ruler.before("emphasis","image",o)};
//# sourceMappingURL=index.cjs.map
